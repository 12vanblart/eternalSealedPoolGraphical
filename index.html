<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Clicker Test</title>
    <script src="https://d3js.org/d3.v5.js"></script>
    <link rel="stylesheet" href="./index.css">
</head>

<body>
    <div id="container">
        <table>
            <tr>
                <td colspan="2">
                    <h1>Playables</h1>
                </td>
            </tr>
            <tr>
                <td>
                    Primal:
                </td>
                <td>
                    <div>
                        <button onclick="decrement(`P`)">
                            -
                        </button>
                        <input id="P" type="number" value="40" min="0" onchange="monoPlayables()">
                        <button onclick="increment(`P`)">
                            +
                        </button>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    Justice:
                </td>
                <td>
                    <div>
                        <button onclick="decrement(`J`)">
                            -
                        </button>
                        <input id="J" type="number" value="3" min="0" onchange="monoPlayables()">
                        <button onclick="increment(`J`)">
                            +
                        </button>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    Shadow:
                </td>
                <td>
                    <div>
                        <button onclick="decrement(`S`)">
                            -
                        </button>
                        <input id="S" type="number" value="3" min="0" onchange="monoPlayables()">
                        <button onclick="increment(`S`)">
                            +
                        </button>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    Fire:
                </td>
                <td>
                    <div>
                        <button onclick="decrement(`F`)">
                            -
                        </button>
                        <input id="F" type="number" value="3" min="0" onchange="monoPlayables()">
                        <button onclick="increment(`F`)">
                            +
                        </button>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    Time:
                </td>
                <td>
                    <div>
                        <button onclick="decrement(`T`)">
                            -
                        </button>
                        <input id="T" type="number" value="3" min="0" onchange="monoPlayables()">
                        <button onclick="increment(`T`)">
                            +
                        </button>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <div id="bestMono"></div>
                </td>
            </tr>
        </table>
    </div>
    <div id="graph"></div>
</body>

<script>
    /*Init charts*/
    monoPlayables()

    function increment(selector) {
        var inputField = document.getElementById(selector);
        inputField.stepUp();
        monoPlayables();
    }

    function decrement(selector) {
        var inputField = document.getElementById(selector);
        inputField.stepDown();
        monoPlayables();
    }

    function monoPlayables() {
        /*Remove old svg's*/
        d3.select("#graph svg").remove();

        /*Data Set*/
        var primal = {
            color: "navy",
            count: document.getElementById('P').value * 2,
            name: "Primal"
        },
            justice = {
                color: "green",
                count: document.getElementById('J').value * 2,
                name: "Justice"
            },
            time = {
                color: "gold",
                count: document.getElementById('T').value * 2,
                name: "Time"
            },
            shadow = {
                color: "rebeccapurple",
                count: document.getElementById('S').value * 2,
                name: "Shadow"
            },
            fire = {
                color: "firebrick",
                count: document.getElementById('F').value * 2,
                name: "Fire"
            }
        /*Chart Settings*/
        //  the size of the overall svg element
        var height = 100
        var width = 80

        //  the width of each bar and the offset between each bar
        var barWidth = 10
        var barOffset = 5
        //  the data that powers the bar chart, a simple array of numeric values
        var chartdata = [primal, justice, time, shadow, fire];
        /*Insert Data => Graph*/

        d3.select('#graph').append('svg')
            .attr('width', width)
            .attr('height', height)
            .style('background', 'snow')
            .selectAll('rect').data(chartdata)
            .enter().append('rect')
            .attr('width', barWidth)
            .attr('height', function (data) {
                return data.count;
            })
            .attr('x', function (data, i) {
                return i * (barWidth + barOffset);
            })
            .attr('y', function (data) {
                return height - data.count;
            })
            .style('fill', function (data) {
                return data.color
            });

        //Set recommended 
        var bestCount = chartdata.reduce((max, objectIn) => Math.max(objectIn.count, max), 0) / 2
        var bestMono = ""
        for (var i = 0; i < chartdata.length; i++) {
            if (chartdata[i].count == bestCount * 2) {
                bestMono = chartdata[i].name
            }
        }
        document.getElementById("bestMono").innerHTML = "Best: " + bestMono
    }

</script>

</html>